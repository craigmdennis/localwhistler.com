"use strict";$(document).ready(function(){$("#results").length&&window.filter.init(),$(".bxslider").bxSlider({adaptiveHeight:!0})});var filter;filter={},function(a,b){return filter={filterCount:0,apiLocation:"/api/get_posts/?post_type=business",settings:{filter_on_init:!0,filter_criteria:{location:[".js__filter-location .TYPE.any","taxonomy_business_location.ARRAY.slug"],type:[".js__filter-type .TYPE.any","taxonomy_business_type.ARRAY.slug"]},search:{input:"#filterSearch",search_in:".media__title, .media__body"},filter_types:{any:function(a,b){return""===a?!0:a===b}},streaming:{data_url:filter.apiLocation,stream_after:1,batch_size:50},callbacks:{after_filter:function(b){a("body").hasClass("view-map")&&googleMap.update_markers(b),filter.push_analytics(),filter.filterCount>0&&(filter.push_history(),filter.result_count(b)),filter.update_styles(),filter.filterCount++}}},init:function(){return a("body").hasClass("view-map")&&googleMap.init(),filter.bind(),filter.create_results(),FilterJS(filter.get_api_data(filter.apiLocation).posts,"#resultsList",filter.view,filter.settings)},bind:function(){Modernizr.history&&(b.onpopstate=filter.set_current_state),a("form").on("submit",filter.override),a("#filterOrder").on("change.sort",filter.result_sort)},create_results:function(){a("#resultsList ").length?a("#resultsList").html(""):a("#results").html('<ol id="resultsList" class="media__list"></ol>')},update_styles:function(){var b="first",c="last",d="visible",e=a(".media");a("."+b+"-"+d).removeClass(b+"-"+d),a("."+c+"-"+d).removeClass(c+"-"+d),e.filter(":"+d+":"+b).addClass(b+"-"+d),e.filter(":"+d+":"+c).addClass(c+"-"+d)},override:function(){event.preventDefault()},get_url:function(){var a=b.location,c=a.pathname.split("/"),d=a.host,e="http://"+d+c[0]+"/";return e},is_location:function(){return""!==filter.get_current_state().location?!0:!1},is_type:function(){return""!==filter.get_current_state().type?!0:!1},is_search:function(){return""!==filter.get_current_state().search?!0:!1},is_order:function(){return""!==filter.get_current_state().order?!0:!1},get_current_state:function(){var b=a("#filterType :selected"),c=a("#filterLocation :selected"),d=a("#filterOrder :selected"),e=a("#filterSearch"),f=a("#filterView"),g={type:b.val(),order:d.val(),location:c.val(),search:e.val(),typeText:b.text(),orderText:d.text(),locationText:c.text(),view:f.val()};return g},set_current_state:function(){a("#filterSearch").val(history.state.search);var b=a("#filterForm").find("select");b.each(function(){a(this).find("option:selected").removeAttr("selected");var b=a(this).find("option");b.each(function(){var b=a(this).val();(b===history.state.location||b===history.state.type||b===history.state.order)&&a(this).attr("selected","selected")})})},generate_url:function(){var a=filter.get_url(),b=filter.get_current_state().location,c=filter.get_current_state().order,d=filter.get_current_state().type,e=filter.get_current_state().search;return a+="?s="+e,a+="&business_location="+b,a+="&business_type="+d,a+="&order="+c},generate_title:function(){var a,b=filter.get_current_state().locationText,c=(filter.get_current_state().orderText,filter.get_current_state().typeText);return a=filter.is_location()?b:filter.is_type()?c:filter.is_search()?c:"Filtering:"+c+" in "+b,a+=" | Local Whistler"},push_history:function(){Modernizr.history&&(a("#filterSearch").is(":focus")?b.history.replaceState(filter.get_current_state(),filter.generate_title(),filter.generate_url()):b.history.pushState(filter.get_current_state(),filter.generate_title(),filter.generate_url()))},push_analytics:function(){ga("send","event","filters","filter",{type:filter.get_current_state.typeText,location:filter.get_current_state.locationText,order:filter.get_current_state.orderText,search:filter.get_current_state.search,nonInteraction:1})},result_sort:function(){var b=a(this).find("option:selected"),c="."+b.attr("data-sort-target"),d=b.attr("data-sort-order");a("ol .media").tsort(c,{order:d}),filter.push_history()},result_count:function(b){a(".js-result-count").text(b.length?"Found: "+b.length:"No businesses found")},get_api_data:function(b){var c;return a.ajax({async:!1,url:b,dataType:"json",success:function(a){c=a}}),c},get_logo:function(b){var c="";return""!==b.custom_fields.logo[0]&&a.each(b.attachments,function(a,d){b.custom_fields.logo[0]===d.id&&(c='<a class="media__link--logo media__link--left media__thumb" href="'+b.url+'"><img class="media__logo" src="'+b.attachments[a].url+'" alt="'+b.title+' Logo" /></a>')}),c},get_tags:function(){},format_date:function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=new Date(a),d=c.getDate(),e=c.getMonth(),f=c.getFullYear(),g=b[e],h={iso:c.toISOString(),pretty:g+" "+d+", "+f};return h},view:function(c){var d=filter.format_date(c.date).iso,e=filter.format_date(c.date).pretty;return a("body").hasClass("view-map")&&b.googleMap.add_marker(c),'<li class="media">'+filter.get_logo(c)+'<div class="media__body context__copy"><h2 class="media__title"><a class="media__link--title" href="'+c.url+'">'+c.title+"</a></h2>"+c.excerpt+'</div><div class="media__footer"><time class="media__date" datetime="'+d+'" class="media__date">'+e+"</time></div>"+filter.get_tags(c)+"</li>"}}}(jQuery,window,document),function(a){var b={},c={mode:"horizontal",slideSelector:"",infiniteLoop:!0,hideControlOnEnd:!1,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:!1,captions:!1,ticker:!1,tickerHover:!1,adaptiveHeight:!1,adaptiveHeightSpeed:500,video:!1,useCSS:!0,preloadImages:"visible",responsive:!0,touchEnabled:!0,swipeThreshold:50,oneToOneTouch:!0,preventDefaultSwipeX:!0,preventDefaultSwipeY:!1,pager:!0,pagerType:"full",pagerShortSeparator:" / ",pagerSelector:null,buildPager:null,pagerCustom:null,controls:!0,nextText:"Next",prevText:"Prev",nextSelector:null,prevSelector:null,autoControls:!1,startText:"Start",stopText:"Stop",autoControlsCombine:!1,autoControlsSelector:null,auto:!1,pause:4e3,autoStart:!0,autoDirection:"next",autoHover:!1,autoDelay:0,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:function(){},onSlideBefore:function(){},onSlideAfter:function(){},onSlideNext:function(){},onSlidePrev:function(){}};a.fn.bxSlider=function(d){if(0==this.length)return this;if(this.length>1)return this.each(function(){a(this).bxSlider(d)}),this;var e={},f=this;b.el=this;var g=a(window).width(),h=a(window).height(),j=function(){e.settings=a.extend({},c,d),e.settings.slideWidth=parseInt(e.settings.slideWidth),e.children=f.children(e.settings.slideSelector),e.children.length<e.settings.minSlides&&(e.settings.minSlides=e.children.length),e.children.length<e.settings.maxSlides&&(e.settings.maxSlides=e.children.length),e.settings.randomStart&&(e.settings.startSlide=Math.floor(Math.random()*e.children.length)),e.active={index:e.settings.startSlide},e.carousel=e.settings.minSlides>1||e.settings.maxSlides>1,e.carousel&&(e.settings.preloadImages="all"),e.minThreshold=e.settings.minSlides*e.settings.slideWidth+(e.settings.minSlides-1)*e.settings.slideMargin,e.maxThreshold=e.settings.maxSlides*e.settings.slideWidth+(e.settings.maxSlides-1)*e.settings.slideMargin,e.working=!1,e.controls={},e.interval=null,e.animProp="vertical"==e.settings.mode?"top":"left",e.usingCSS=e.settings.useCSS&&"fade"!=e.settings.mode&&function(){var a=document.createElement("div"),b=["WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var c in b)if(void 0!==a.style[b[c]])return e.cssPrefix=b[c].replace("Perspective","").toLowerCase(),e.animProp="-"+e.cssPrefix+"-transform",!0;return!1}(),"vertical"==e.settings.mode&&(e.settings.maxSlides=e.settings.minSlides),f.data("origStyle",f.attr("style")),f.children(e.settings.slideSelector).each(function(){a(this).data("origStyle",a(this).attr("style"))}),k()},k=function(){f.wrap('<div class="bx-wrapper"><div class="bx-viewport"></div></div>'),e.viewport=f.parent(),e.loader=a('<div class="bx-loading" />'),e.viewport.prepend(e.loader),f.css({width:"horizontal"==e.settings.mode?100*e.children.length+215+"%":"auto",position:"relative"}),e.usingCSS&&e.settings.easing?f.css("-"+e.cssPrefix+"-transition-timing-function",e.settings.easing):e.settings.easing||(e.settings.easing="swing");q();e.viewport.css({width:"100%",overflow:"hidden",position:"relative"}),e.viewport.parent().css({maxWidth:o()}),e.settings.pager||e.viewport.parent().css({margin:"0 auto 0px"}),e.children.css({"float":"horizontal"==e.settings.mode?"left":"none",listStyle:"none",position:"relative"}),e.children.css("width",p()),"horizontal"==e.settings.mode&&e.settings.slideMargin>0&&e.children.css("marginRight",e.settings.slideMargin),"vertical"==e.settings.mode&&e.settings.slideMargin>0&&e.children.css("marginBottom",e.settings.slideMargin),"fade"==e.settings.mode&&(e.children.css({position:"absolute",zIndex:0,display:"none"}),e.children.eq(e.settings.startSlide).css({zIndex:50,display:"block"})),e.controls.el=a('<div class="bx-controls" />'),e.settings.captions&&z(),e.active.last=e.settings.startSlide==r()-1,e.settings.video&&f.fitVids();var b=e.children.eq(e.settings.startSlide);"all"==e.settings.preloadImages&&(b=e.children),e.settings.ticker?e.settings.pager=!1:(e.settings.pager&&w(),e.settings.controls&&x(),e.settings.auto&&e.settings.autoControls&&y(),(e.settings.controls||e.settings.autoControls||e.settings.pager)&&e.viewport.after(e.controls.el)),l(b,m)},l=function(b,c){var d=b.find("img, iframe").length;if(0==d)return void c();var e=0;b.find("img, iframe").each(function(){a(this).one("load",function(){++e==d&&c()}).each(function(){this.complete&&a(this).load()})})},m=function(){if(e.settings.infiniteLoop&&"fade"!=e.settings.mode&&!e.settings.ticker){var b="vertical"==e.settings.mode?e.settings.minSlides:e.settings.maxSlides,c=e.children.slice(0,b).clone().addClass("bx-clone"),d=e.children.slice(-b).clone().addClass("bx-clone");f.append(c).prepend(d)}e.loader.remove(),t(),"vertical"==e.settings.mode&&(e.settings.adaptiveHeight=!0),e.viewport.height(n()),f.redrawSlider(),e.settings.onSliderLoad(e.active.index),e.initialized=!0,e.settings.responsive&&a(window).bind("resize",Q),e.settings.auto&&e.settings.autoStart&&J(),e.settings.ticker&&K(),e.settings.pager&&F(e.settings.startSlide),e.settings.controls&&I(),e.settings.touchEnabled&&!e.settings.ticker&&M()},n=function(){var b=0,c=a();if("vertical"==e.settings.mode||e.settings.adaptiveHeight)if(e.carousel){var d=1==e.settings.moveSlides?e.active.index:e.active.index*s();for(c=e.children.eq(d),i=1;i<=e.settings.maxSlides-1;i++)c=c.add(d+i>=e.children.length?e.children.eq(i-1):e.children.eq(d+i))}else c=e.children.eq(e.active.index);else c=e.children;return"vertical"==e.settings.mode?(c.each(function(){b+=a(this).outerHeight()}),e.settings.slideMargin>0&&(b+=e.settings.slideMargin*(e.settings.minSlides-1))):b=Math.max.apply(Math,c.map(function(){return a(this).outerHeight(!1)}).get()),b},o=function(){var a="100%";return e.settings.slideWidth>0&&(a="horizontal"==e.settings.mode?e.settings.maxSlides*e.settings.slideWidth+(e.settings.maxSlides-1)*e.settings.slideMargin:e.settings.slideWidth),a},p=function(){var a=e.settings.slideWidth,b=e.viewport.width();return 0==e.settings.slideWidth||e.settings.slideWidth>b&&!e.carousel||"vertical"==e.settings.mode?a=b:e.settings.maxSlides>1&&"horizontal"==e.settings.mode&&(b>e.maxThreshold||b<e.minThreshold&&(a=(b-e.settings.slideMargin*(e.settings.minSlides-1))/e.settings.minSlides)),a},q=function(){var a=1;if("horizontal"==e.settings.mode&&e.settings.slideWidth>0)if(e.viewport.width()<e.minThreshold)a=e.settings.minSlides;else if(e.viewport.width()>e.maxThreshold)a=e.settings.maxSlides;else{var b=e.children.first().width();a=Math.floor(e.viewport.width()/b)}else"vertical"==e.settings.mode&&(a=e.settings.minSlides);return a},r=function(){var a=0;if(e.settings.moveSlides>0)if(e.settings.infiniteLoop)a=e.children.length/s();else for(var b=0,c=0;b<e.children.length;)++a,b=c+q(),c+=e.settings.moveSlides<=q()?e.settings.moveSlides:q();else a=Math.ceil(e.children.length/q());return a},s=function(){return e.settings.moveSlides>0&&e.settings.moveSlides<=q()?e.settings.moveSlides:q()},t=function(){if(e.children.length>e.settings.maxSlides&&e.active.last&&!e.settings.infiniteLoop){if("horizontal"==e.settings.mode){var a=e.children.last(),b=a.position();u(-(b.left-(e.viewport.width()-a.width())),"reset",0)}else if("vertical"==e.settings.mode){var c=e.children.length-e.settings.minSlides,b=e.children.eq(c).position();u(-b.top,"reset",0)}}else{var b=e.children.eq(e.active.index*s()).position();e.active.index==r()-1&&(e.active.last=!0),void 0!=b&&("horizontal"==e.settings.mode?u(-b.left,"reset",0):"vertical"==e.settings.mode&&u(-b.top,"reset",0))}},u=function(a,b,c,d){if(e.usingCSS){var g="vertical"==e.settings.mode?"translate3d(0, "+a+"px, 0)":"translate3d("+a+"px, 0, 0)";f.css("-"+e.cssPrefix+"-transition-duration",c/1e3+"s"),"slide"==b?(f.css(e.animProp,g),f.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),G()})):"reset"==b?f.css(e.animProp,g):"ticker"==b&&(f.css("-"+e.cssPrefix+"-transition-timing-function","linear"),f.css(e.animProp,g),f.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),u(d.resetValue,"reset",0),L()}))}else{var h={};h[e.animProp]=a,"slide"==b?f.animate(h,c,e.settings.easing,function(){G()}):"reset"==b?f.css(e.animProp,a):"ticker"==b&&f.animate(h,speed,"linear",function(){u(d.resetValue,"reset",0),L()})}},v=function(){for(var b="",c=r(),d=0;c>d;d++){var f="";e.settings.buildPager&&a.isFunction(e.settings.buildPager)?(f=e.settings.buildPager(d),e.pagerEl.addClass("bx-custom-pager")):(f=d+1,e.pagerEl.addClass("bx-default-pager")),b+='<div class="bx-pager-item"><a href="" data-slide-index="'+d+'" class="bx-pager-link">'+f+"</a></div>"}e.pagerEl.html(b)},w=function(){e.settings.pagerCustom?e.pagerEl=a(e.settings.pagerCustom):(e.pagerEl=a('<div class="bx-pager" />'),e.settings.pagerSelector?a(e.settings.pagerSelector).html(e.pagerEl):e.controls.el.addClass("bx-has-pager").append(e.pagerEl),v()),e.pagerEl.delegate("a","click",E)},x=function(){e.controls.next=a('<a class="bx-next" href="">'+e.settings.nextText+"</a>"),e.controls.prev=a('<a class="bx-prev" href="">'+e.settings.prevText+"</a>"),e.controls.next.bind("click",A),e.controls.prev.bind("click",B),e.settings.nextSelector&&a(e.settings.nextSelector).append(e.controls.next),e.settings.prevSelector&&a(e.settings.prevSelector).append(e.controls.prev),e.settings.nextSelector||e.settings.prevSelector||(e.controls.directionEl=a('<div class="bx-controls-direction" />'),e.controls.directionEl.append(e.controls.prev).append(e.controls.next),e.controls.el.addClass("bx-has-controls-direction").append(e.controls.directionEl))},y=function(){e.controls.start=a('<div class="bx-controls-auto-item"><a class="bx-start" href="">'+e.settings.startText+"</a></div>"),e.controls.stop=a('<div class="bx-controls-auto-item"><a class="bx-stop" href="">'+e.settings.stopText+"</a></div>"),e.controls.autoEl=a('<div class="bx-controls-auto" />'),e.controls.autoEl.delegate(".bx-start","click",C),e.controls.autoEl.delegate(".bx-stop","click",D),e.settings.autoControlsCombine?e.controls.autoEl.append(e.controls.start):e.controls.autoEl.append(e.controls.start).append(e.controls.stop),e.settings.autoControlsSelector?a(e.settings.autoControlsSelector).html(e.controls.autoEl):e.controls.el.addClass("bx-has-controls-auto").append(e.controls.autoEl),H(e.settings.autoStart?"stop":"start")},z=function(){e.children.each(function(){var b=a(this).find("img:first").attr("title");void 0!=b&&(""+b).length&&a(this).append('<div class="bx-caption"><span>'+b+"</span></div>")})},A=function(a){e.settings.auto&&f.stopAuto(),f.goToNextSlide(),a.preventDefault()},B=function(a){e.settings.auto&&f.stopAuto(),f.goToPrevSlide(),a.preventDefault()},C=function(a){f.startAuto(),a.preventDefault()},D=function(a){f.stopAuto(),a.preventDefault()},E=function(b){e.settings.auto&&f.stopAuto();var c=a(b.currentTarget),d=parseInt(c.attr("data-slide-index"));d!=e.active.index&&f.goToSlide(d),b.preventDefault()},F=function(b){var c=e.children.length;return"short"==e.settings.pagerType?(e.settings.maxSlides>1&&(c=Math.ceil(e.children.length/e.settings.maxSlides)),void e.pagerEl.html(b+1+e.settings.pagerShortSeparator+c)):(e.pagerEl.find("a").removeClass("active"),void e.pagerEl.each(function(c,d){a(d).find("a").eq(b).addClass("active")}))},G=function(){if(e.settings.infiniteLoop){var a="";0==e.active.index?a=e.children.eq(0).position():e.active.index==r()-1&&e.carousel?a=e.children.eq((r()-1)*s()).position():e.active.index==e.children.length-1&&(a=e.children.eq(e.children.length-1).position()),a&&("horizontal"==e.settings.mode?u(-a.left,"reset",0):"vertical"==e.settings.mode&&u(-a.top,"reset",0))}e.working=!1,e.settings.onSlideAfter(e.children.eq(e.active.index),e.oldIndex,e.active.index)},H=function(a){e.settings.autoControlsCombine?e.controls.autoEl.html(e.controls[a]):(e.controls.autoEl.find("a").removeClass("active"),e.controls.autoEl.find("a:not(.bx-"+a+")").addClass("active"))},I=function(){1==r()?(e.controls.prev.addClass("disabled"),e.controls.next.addClass("disabled")):!e.settings.infiniteLoop&&e.settings.hideControlOnEnd&&(0==e.active.index?(e.controls.prev.addClass("disabled"),e.controls.next.removeClass("disabled")):e.active.index==r()-1?(e.controls.next.addClass("disabled"),e.controls.prev.removeClass("disabled")):(e.controls.prev.removeClass("disabled"),e.controls.next.removeClass("disabled")))},J=function(){if(e.settings.autoDelay>0){setTimeout(f.startAuto,e.settings.autoDelay)}else f.startAuto();e.settings.autoHover&&f.hover(function(){e.interval&&(f.stopAuto(!0),e.autoPaused=!0)},function(){e.autoPaused&&(f.startAuto(!0),e.autoPaused=null)})},K=function(){var b=0;if("next"==e.settings.autoDirection)f.append(e.children.clone().addClass("bx-clone"));else{f.prepend(e.children.clone().addClass("bx-clone"));var c=e.children.first().position();b="horizontal"==e.settings.mode?-c.left:-c.top}u(b,"reset",0),e.settings.pager=!1,e.settings.controls=!1,e.settings.autoControls=!1,e.settings.tickerHover&&!e.usingCSS&&e.viewport.hover(function(){f.stop()},function(){var b=0;e.children.each(function(){b+="horizontal"==e.settings.mode?a(this).outerWidth(!0):a(this).outerHeight(!0)});var c=e.settings.speed/b,d="horizontal"==e.settings.mode?"left":"top",g=c*(b-Math.abs(parseInt(f.css(d))));L(g)}),L()},L=function(a){speed=a?a:e.settings.speed;var b={left:0,top:0},c={left:0,top:0};"next"==e.settings.autoDirection?b=f.find(".bx-clone").first().position():c=e.children.first().position();var d="horizontal"==e.settings.mode?-b.left:-b.top,g="horizontal"==e.settings.mode?-c.left:-c.top,h={resetValue:g};u(d,"ticker",speed,h)},M=function(){e.touch={start:{x:0,y:0},end:{x:0,y:0}},e.viewport.bind("touchstart",N)},N=function(a){if(e.working)a.preventDefault();else{e.touch.originalPos=f.position();var b=a.originalEvent;e.touch.start.x=b.changedTouches[0].pageX,e.touch.start.y=b.changedTouches[0].pageY,e.viewport.bind("touchmove",O),e.viewport.bind("touchend",P)}},O=function(a){var b=a.originalEvent,c=Math.abs(b.changedTouches[0].pageX-e.touch.start.x),d=Math.abs(b.changedTouches[0].pageY-e.touch.start.y);if(3*c>d&&e.settings.preventDefaultSwipeX?a.preventDefault():3*d>c&&e.settings.preventDefaultSwipeY&&a.preventDefault(),"fade"!=e.settings.mode&&e.settings.oneToOneTouch){var f=0;if("horizontal"==e.settings.mode){var g=b.changedTouches[0].pageX-e.touch.start.x;f=e.touch.originalPos.left+g}else{var g=b.changedTouches[0].pageY-e.touch.start.y;f=e.touch.originalPos.top+g}u(f,"reset",0)}},P=function(a){e.viewport.unbind("touchmove",O);var b=a.originalEvent,c=0;if(e.touch.end.x=b.changedTouches[0].pageX,e.touch.end.y=b.changedTouches[0].pageY,"fade"==e.settings.mode){var d=Math.abs(e.touch.start.x-e.touch.end.x);d>=e.settings.swipeThreshold&&(e.touch.start.x>e.touch.end.x?f.goToNextSlide():f.goToPrevSlide(),f.stopAuto())}else{var d=0;"horizontal"==e.settings.mode?(d=e.touch.end.x-e.touch.start.x,c=e.touch.originalPos.left):(d=e.touch.end.y-e.touch.start.y,c=e.touch.originalPos.top),!e.settings.infiniteLoop&&(0==e.active.index&&d>0||e.active.last&&0>d)?u(c,"reset",200):Math.abs(d)>=e.settings.swipeThreshold?(0>d?f.goToNextSlide():f.goToPrevSlide(),f.stopAuto()):u(c,"reset",200)}e.viewport.unbind("touchend",P)},Q=function(){var b=a(window).width(),c=a(window).height();(g!=b||h!=c)&&(g=b,h=c,f.redrawSlider())};return f.goToSlide=function(b,c){if(!e.working&&e.active.index!=b)if(e.working=!0,e.oldIndex=e.active.index,e.active.index=0>b?r()-1:b>=r()?0:b,e.settings.onSlideBefore(e.children.eq(e.active.index),e.oldIndex,e.active.index),"next"==c?e.settings.onSlideNext(e.children.eq(e.active.index),e.oldIndex,e.active.index):"prev"==c&&e.settings.onSlidePrev(e.children.eq(e.active.index),e.oldIndex,e.active.index),e.active.last=e.active.index>=r()-1,e.settings.pager&&F(e.active.index),e.settings.controls&&I(),"fade"==e.settings.mode)e.settings.adaptiveHeight&&e.viewport.height()!=n()&&e.viewport.animate({height:n()},e.settings.adaptiveHeightSpeed),e.children.filter(":visible").fadeOut(e.settings.speed).css({zIndex:0}),e.children.eq(e.active.index).css("zIndex",51).fadeIn(e.settings.speed,function(){a(this).css("zIndex",50),G()});else{e.settings.adaptiveHeight&&e.viewport.height()!=n()&&e.viewport.animate({height:n()},e.settings.adaptiveHeightSpeed);var d=0,g={left:0,top:0};if(!e.settings.infiniteLoop&&e.carousel&&e.active.last)if("horizontal"==e.settings.mode){var h=e.children.eq(e.children.length-1);g=h.position(),d=e.viewport.width()-h.outerWidth()}else{var i=e.children.length-e.settings.minSlides;g=e.children.eq(i).position()}else if(e.carousel&&e.active.last&&"prev"==c){var j=1==e.settings.moveSlides?e.settings.maxSlides-s():(r()-1)*s()-(e.children.length-e.settings.maxSlides),h=f.children(".bx-clone").eq(j);g=h.position()}else if("next"==c&&0==e.active.index)g=f.find("> .bx-clone").eq(e.settings.maxSlides).position(),e.active.last=!1;else if(b>=0){var k=b*s();g=e.children.eq(k).position()}if("undefined"!=typeof g){var l="horizontal"==e.settings.mode?-(g.left-d):-g.top;u(l,"slide",e.settings.speed)}}},f.goToNextSlide=function(){if(e.settings.infiniteLoop||!e.active.last){var a=parseInt(e.active.index)+1;f.goToSlide(a,"next")}},f.goToPrevSlide=function(){if(e.settings.infiniteLoop||0!=e.active.index){var a=parseInt(e.active.index)-1;f.goToSlide(a,"prev")}},f.startAuto=function(a){e.interval||(e.interval=setInterval(function(){"next"==e.settings.autoDirection?f.goToNextSlide():f.goToPrevSlide()},e.settings.pause),e.settings.autoControls&&1!=a&&H("stop"))},f.stopAuto=function(a){e.interval&&(clearInterval(e.interval),e.interval=null,e.settings.autoControls&&1!=a&&H("start"))},f.getCurrentSlide=function(){return e.active.index},f.getSlideCount=function(){return e.children.length},f.redrawSlider=function(){e.children.add(f.find(".bx-clone")).outerWidth(p()),e.viewport.css("height",n()),e.settings.ticker||t(),e.active.last&&(e.active.index=r()-1),e.active.index>=r()&&(e.active.last=!0),e.settings.pager&&!e.settings.pagerCustom&&(v(),F(e.active.index))},f.destroySlider=function(){e.initialized&&(e.initialized=!1,a(".bx-clone",this).remove(),e.children.each(function(){void 0!=a(this).data("origStyle")?a(this).attr("style",a(this).data("origStyle")):a(this).removeAttr("style")}),void 0!=a(this).data("origStyle")?this.attr("style",a(this).data("origStyle")):a(this).removeAttr("style"),a(this).unwrap().unwrap(),e.controls.el&&e.controls.el.remove(),e.controls.next&&e.controls.next.remove(),e.controls.prev&&e.controls.prev.remove(),e.pagerEl&&e.settings.controls&&e.pagerEl.remove(),a(".bx-caption",this).remove(),e.controls.autoEl&&e.controls.autoEl.remove(),clearInterval(e.interval),e.settings.responsive&&a(window).unbind("resize",Q))},f.reloadSlider=function(a){void 0!=a&&(d=a),f.destroySlider(),j()},j(),this}}(jQuery),function(a,b){function c(a){return a&&a.toLowerCase?a.toLowerCase():a}function d(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return!e;return e}var e=!1,f=null,g=parseFloat,h=Math.min,i=/(-?\d+\.?\d*)$/g,j=/(\d+\.?\d*)$/g,k=[],l=[],m=function(a){return"string"==typeof a},n=function(a,b){for(var c,d=a.length,e=d;e--;)c=d-e-1,b(a[c],c)},o=Array.prototype.indexOf||function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1};a.tinysort={id:"TinySort",version:"1.5.6",copyright:"Copyright (c) 2008-2013 Ron Valstar",uri:"http://tinysort.sjeiti.com/",licensed:{MIT:"http://www.opensource.org/licenses/mit-license.php",GPL:"http://www.gnu.org/licenses/gpl.html"},plugin:function(){var a=function(a,b){k.push(a),l.push(b)};return a.indexOf=o,a}(),defaults:{order:"asc",attr:f,data:f,useVal:e,place:"start",returns:e,cases:e,forceStrings:e,ignoreDashes:e,sortFunction:f}},a.fn.extend({tinysort:function(){var p,q,r,s,t=this,u=[],v=[],w=[],x=[],y=0,z=[],A=[],B=function(a){n(k,function(b){b.call(b,a)})},C=function(a,b){return"string"==typeof b&&(a.cases||(b=c(b)),b=b.replace(/^\s*(.*?)\s*$/i,"$1")),b},D=function(a,b){var c=0;for(0!==y&&(y=0);0===c&&s>y;){var d=x[y],f=d.oSettings,h=f.ignoreDashes?j:i;if(B(f),f.sortFunction)c=f.sortFunction(a,b);else if("rand"==f.order)c=Math.random()<.5?1:-1;else{var k=e,o=C(f,a.s[y]),p=C(f,b.s[y]);if(!f.forceStrings){var q=m(o)?o&&o.match(h):e,r=m(p)?p&&p.match(h):e;if(q&&r){var t=o.substr(0,o.length-q[0].length),u=p.substr(0,p.length-r[0].length);t==u&&(k=!e,o=g(q[0]),p=g(r[0]))}}c=d.iAsc*(p>o?-1:o>p?1:0)}n(l,function(a){c=a.call(a,k,o,p,c)}),0===c&&y++}return c};for(p=0,r=arguments.length;r>p;p++){var E=arguments[p];m(E)?z.push(E)-1>A.length&&(A.length=z.length-1):A.push(E)>z.length&&(z.length=A.length)}for(z.length>A.length&&(A.length=z.length),s=z.length,0===s&&(s=z.length=1,A.push({})),p=0,r=s;r>p;p++){var F=z[p],G=a.extend({},a.tinysort.defaults,A[p]),H=!(!F||""===F),I=H&&":"===F[0];x.push({sFind:F,oSettings:G,bFind:H,bAttr:!(G.attr===f||""===G.attr),bData:G.data!==f,bFilter:I,$Filter:I?t.filter(F):t,fnSort:G.sortFunction,iAsc:"asc"==G.order?1:-1})}return t.each(function(c,d){var e,f=a(d),g=f.parent().get(0),h=[];for(q=0;s>q;q++){var i=x[q],j=i.bFind?i.bFilter?i.$Filter.filter(d):f.find(i.sFind):f;h.push(i.bData?j.data(i.oSettings.data):i.bAttr?j.attr(i.oSettings.attr):i.oSettings.useVal?j.val():j.text()),e===b&&(e=j)}var k=o.call(w,g);0>k&&(k=w.push(g)-1,v[k]={s:[],n:[]}),e.length>0?v[k].s.push({s:h,e:f,n:c}):v[k].n.push({e:f,n:c})}),n(v,function(a){a.s.sort(D)}),n(v,function(a){var b=a.s,c=a.n,f=b.length,g=c.length,i=f+g,j=[],k=i,l=[0,0];switch(G.place){case"first":n(b,function(a){k=h(k,a.n)});break;case"org":n(b,function(a){j.push(a.n)});break;case"end":k=g;break;default:k=0}for(p=0;i>p;p++){var m=d(j,p)?!e:p>=k&&k+f>p,o=m?0:1,q=(m?b:c)[l[o]].e;q.parent().append(q),(m||!G.returns)&&u.push(q.get(0)),l[o]++}}),t.length=0,Array.prototype.push.apply(t,u),t}}),a.fn.TinySort=a.fn.Tinysort=a.fn.tsort=a.fn.tinysort}(jQuery);var googleMap;googleMap={},function(a,b,c){return googleMap={center_lat_lng:[50.11632,-122.957356],map:null,markers:{},bounds:null,init:function(){var a={scrollwheel:!1,center:new google.maps.LatLng(this.center_lat_lng[0],this.center_lat_lng[1]),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,maxZoom:17,suppressInfoWindows:!0};this.create_map(),this.map=new google.maps.Map(c.getElementById("resultsMap"),a),this.infowindow=new google.maps.InfoWindow({maxWidth:300})},create_map:function(){a("#results").prepend('<div id="resultsMap" class="map--full js-mapping"></div>')},add_marker:function(a){var b=a.custom_fields.martygeocoderlatlng[0].slice(1,-1),c=b.split(", "),d=this,e=new google.maps.Marker({position:new google.maps.LatLng(c[0],c[1]),title:a.title,map:this.map});e.setMap(this.map),e.info_window_content='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">'+a.title+'</h1><div id="bodyContent">'+a.excerpt+' <br><a href="'+a.url+'">More info</a></div></div>',this.markers[a.id]=e,google.maps.event.addListener(e,"click",function(){d.infowindow.setContent(e.info_window_content),d.infowindow.open(d.map,e)})},update_markers:function(b){this.bounds=new google.maps.LatLngBounds,a.each(this.markers,function(){this.setMap(null)}),b.length?a.each(b,function(a,b){googleMap.markers[b].setMap(googleMap.map),googleMap.bounds.extend(new google.maps.LatLng(googleMap.markers[b].position.k,googleMap.markers[b].position.B))}):googleMap.bounds.extend(new google.maps.LatLng(googleMap.center_lat_lng[0],googleMap.center_lat_lng[1])),this.set_center_point()},set_center_point:function(){this.map.setCenter(this.bounds.getCenter()),this.map.fitBounds(this.bounds)}}}(jQuery,window,document),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(window){var FilterJS=function(a,b,c,d){return new _FilterJS(a,b,c,d)};FilterJS.VERSION="1.5.1",$.fn.filterjs=function(a,b,c){var d=$(this);d.data("fjs")||d.data("fjs",new _FilterJS(a,d,b,c))},window.FilterJS=FilterJS;var _FilterJS=function(a,b,c,d){var e,f=0;this.data=a,this.view=c,this.container=b,this.options=d||{},this.categories_map={},this.record_ids=[],this.data.constructor!=Array&&(this.data=[this.data]);for(e in this.data[0])this.root=e,f+=1;return 1==f?this.getRecord=function(a,b){return b[a][this.root]}:(this.getRecord=function(a,b){return b[a]},this.root="fjs"),this.id_field=this.options.id_field||"id",this.render(this.data),this.parseOptions(),this.buildCategoryMap(this.data),this.bindEvents(),this.options.callbacks=this.options.callbacks||{},this.execCallBack("after_init",this.record_ids),this.execCallBack("after_add",this.data),this.options.filter_types=this.options.filter_types||{},this.options.filter_types.range||(this.options.filter_types.range=this.rangeFilter),this.options.streaming=this.options.streaming||{},this.options.streaming.data_url&&(this.options.streaming.stream_after=1e3*(this.options.streaming.stream_after||2),this.options.streaming.batch_size=this.options.streaming.batch_size||!1,this.streamData(this.options.streaming.stream_after)),(void 0==this.options.filter_on_init||1==this.options.filter_on_init)&&(this.options.filter_on_init=!0,this.filter()),this};_FilterJS.prototype={render:function(a){var b,c,d=$(this.container);if(a)for(var e=0,f=a.length;f>e;e++)b=this.getRecord(e,a),c=$(this.view(b)),c.attr({id:this.root+"_"+b[this.id_field],"data-fjs":!0}),c=d.append(c)},bindEvents:function(){var a=this,b=this.options.selectors,c=0,d=b.length;for(c;d>c;c++)this.bindSelectorEvent(b[c],a);this.options.search&&$(this.options.search.input).on("keyup",function(){a.filter()})},bindSelectorEvent:function(a,b){$(a.element).on(a.events,function(){b.filter()})},clear:function(){var a=this.options.selectors,b=0,c=a.length;for(b;c>b;b++)$(a[b].element).off(a[b].events);this.options.search&&$(this.options.search.input).off("keyup"),this.category_map=null,this.record_ids=null},filter:function(){var a,b,c,d,e=!1,f=0,g=this.options.selectors.length;if(g){for(f;g>f;f++)b=this.options.selectors[f],c=$(b.element).filter(b.select).map(function(){return $(this).val()}),c.length?(d=this.findObjects(c,this.categories_map[b.name],this.options.filter_types[b.type]),a=$.grep(a||this.record_ids,function(a){return-1!=d.indexOf(a)})):e=!0;e&&this.options.and_filter_on&&(a=[])}else a=this.record_ids;this.options.search&&(a=this.search(this.options.search,a)),this.hideShow(a),this.execCallBack("after_filter",a)},findObjects:function(a,b,c){var d,e,f=[],g=0,h=a.length;
for(g;h>g;g++)e=a[g],d=c?$.map(b,function(a,b){return c(e,b)?a:void 0}):b.constructor==Array?b:b[e],d&&(f=f.concat(d));return f},buildEvalString:function(a){var b,c=a.split(".ARRAY."),d=1,e=c.length;for(b=c[0],d;e>d;d++)b+=".filter_collect('"+c[d]+"')";return b},addFilterCriteria:function(a,b,c){this.categories_map[a]={};var d=this.parseSelectorOptions({name:a},[b]);c=c||$(d.element).data("ids")||[],this.options.selectors.push(d),this.categories_map[a]=c,this.bindSelectorEvent(d,this)},parseOptions:function(){var a,b,c,d=this.options.filter_criteria;this.options.selectors=[];for(c in d)b=d[c],a=this.parseSelectorOptions({name:c},b),this.options.selectors.push(a),b.push(this.buildEvalString(b[1])),this.categories_map[c]={}},parseSelectorOptions:function(a,b){a.element=b[0].split(/.EVENT.|.SELECT.|.TYPE./)[0],a.events=(b[0].match(/.EVENT.(\S*)/)||[])[1],a.select=(b[0].match(/.SELECT.(\S*)/)||[])[1],a.type=(b[0].match(/.TYPE.(\S*)/)||[])[1];var c=$(a.element),d=c.attr("type");return a.select||("INPUT"==c.get(0).tagName?"checkbox"==d||"radio"==d?a.select=":checked":("hidden"==d||"text"==d)&&(a.select=":input"):"SELECT"==c.get(0).tagName&&(a.select="select")),a.events||("checkbox"==d||"radio"==d?a.events="click":("hidden"==d||"SELECT"==c.get(0).tagName)&&(a.events="change")),a},buildCategoryMap:function(data){for(var filter_criteria=this.options.filter_criteria,record,categories,obj,x,i=0,l=data.length;l>i;i++){record=this.getRecord(i,data),this.record_ids.push(record[this.id_field]);for(name in filter_criteria)if(categories=eval("record."+filter_criteria[name][2]),obj=this.categories_map[name],categories&&categories.constructor==Array)for(var j=0,lj=categories.length;lj>j;j++)x=categories[j],obj[x]?obj[x].push(record[this.id_field]):obj[x]=[record[this.id_field]];else obj[categories]?obj[categories].push(record[this.id_field]):obj[categories]=[record[this.id_field]]}},hideShow:function(a){var b="#"+this.root+"_",c=0,d=a.length;for($(this.container+" > *[data-fjs]").hide(),c;d>c;c++)$(b+a[c]).show()},search:function(a,b){var c=$.trim($(a.input).val()),d=a.search_in,e=$.isNumeric(a.min_length)?a.min_length:1;if(c.length<e)return b;var f="#"+this.root+"_";return c=c.toUpperCase(),$.map(b,function(a){var b=$(f+a);return d&&(b=b.find(d)),b.text().toUpperCase().indexOf(c)>=0?a:void 0})},execCallBack:function(a,b){this.options.callbacks[a]&&this.options.callbacks[a].call(this,b)},rangeFilter:function(a,b){var c=a.split("-");return 2==c.length&&("below"==c[0]&&(c[0]=-1/0),"above"==c[1]&&(c[1]=1/0),Number(b)>=c[0]&&Number(b)<=c[1])?!0:void 0},getRecordsByIds:function(a){var b,c=[],d=0,e=this.data.length;for(d;e>d;d++)b=this.getRecord(d,this.data),-1!=a.indexOf(b[this.id_field])&&c.push(b);return c},addData:function(a){if(void 0!=a&&0!=a.length){{a.length,"#"+this.root+"_"}this.execCallBack("before_add",a),this.data=this.data.concat(a),this.render(a),this.buildCategoryMap(a),this.execCallBack("after_add",a),this.filter()}},setStreamingTimer:function(){var a=this,b=this.options.streaming.batch_size?setInterval:setTimeout;return b(function(){a.streamData()},this.options.streaming.stream_after)},clearStreamingTimer:function(){this.timer&&clearTimeout(this.timer)},fetchData:function(){var a=this,b=this.options.params||{},c=this.options.streaming;b.offset=this.data.length,c.batch_size&&(b.limit=c.batch_size),this.options.search&&(b.q=$.trim($(this.options.search.input).val())),$.getJSON(c.data_url,b).done(function(c){null==b.limit||c&&c.length?(a.setStreamInterval(),a.addData(c)):a.stopStreaming()}).fail(function(){a.stopStreaming()})},setStreamInterval:function(){var a=this;1!=a.options.streaming.stop_streaming&&(a.timer=setTimeout(function(){a.fetchData()},a.options.streaming.stream_after))},stopStreaming:function(){this.options.streaming.stop_streaming=!0,this.timer&&clearTimeout(this.timer)},resumeStreaming:function(){this.options.streaming.stop_streaming=!1,this.streamData(this.options.streaming.stream_after)},streamData:function(){this.setStreamInterval(),this.options.streaming.batch_size||this.stopStreaming()}}}(this),Array.prototype.filter_collect=function(a,b){for(var b=b||[],c=0,d=this.length;d>c;c++){var e=this[c];e.constructor==Array?e.filter_collect(a,b):b.push(e[a])}return b},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1});
//# sourceMappingURL=script.js.map